(function(){"use strict";const a={PHASE:0,VERSION:1};function i(o,t){const n=new Int32Array(o,0,2);let e=2*4;const A=new Float32Array(o,e,t);e+=t*4;const p=new Float32Array(o,e,t);e+=t*4;const I=new Float32Array(o,e,t);e+=t*4;const g=new Float32Array(o,e,t);e+=t*4;const N=new Uint8Array(o,e,t);e+=t;const R=new Uint8Array(o,e,t);e+=t;const u=new Uint8Array(o,e,t);return{control:n,posX:A,posY:p,posZ:I,rotation:g,type:N,owner:R,active:u}}let c=null,s=0,r=null,l=null;self.onmessage=o=>{const{type:t,data:n}=o.data;if(console.log("[SimulationWorker] Message reçu:",t),t==="INIT")try{if(c=n.buffer,s=n.maxUnits,!c||s<=0){postMessage({type:"ERROR",message:"Invalid INIT payload"});return}r=i(c,s),Atomics.store(r.control,a.PHASE,1),console.log("[SimulationWorker] Initialisé avec",s,"unités"),postMessage({type:"INIT_ACK",data:{maxUnits:s}}),postMessage({type:"READY"}),l!==null&&clearInterval(l);const e=60;l=setInterval(()=>y(1/e),Math.floor(1e3/e))}catch(e){postMessage({type:"ERROR",message:String(e)})}};function y(o){if(!(!r||!s))try{Atomics.store(r.control,a.PHASE,2);const{active:t}=r;for(let n=0;n<s;n++)t[n];Atomics.store(r.control,a.PHASE,1)}catch(t){postMessage({type:"ERROR",message:String(t)}),l!==null&&(clearInterval(l),l=null)}}})();
//# sourceMappingURL=SimulationWorker-CKl5zPEe.js.map
